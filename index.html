<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Mystery Box</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Courier New', monospace;
        }
        
        body {
            background: #0a0a0a;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
            color: #00ff00;
        }
        
        .scene {
            perspective: 1000px;
            width: 300px;
            height: 300px;
        }
        
        .box {
            width: 100%;
            height: 100%;
            position: relative;
            transform-style: preserve-3d;
            transition: transform 2s;
            cursor: pointer;
        }
        
        .face {
            position: absolute;
            width: 300px;
            height: 300px;
            background: #1a1a1a;
            border: 2px solid #00ff00;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 20px;
            text-align: center;
        }
        
        .front  { transform: translateZ(150px); }
        .back   { transform: rotateY(180deg) translateZ(150px); }
        .right  { transform: rotateY(90deg) translateZ(150px); }
        .left   { transform: rotateY(-90deg) translateZ(150px); }
        .top    { transform: rotateX(90deg) translateZ(150px); }
        .bottom { transform: rotateX(-90deg) translateZ(150px); }
        
        .locked {
            background: #2a1a1a;
            border-color: #ff0000;
        }
        
        .puzzle-interface {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: #1a1a1a;
            padding: 30px;
            border: 2px solid #00ff00;
            border-radius: 10px;
            z-index: 100;
        }
        
        .pattern-grid {
            display: grid;
            grid-template-columns: repeat(3, 60px);
            gap: 10px;
            margin: 20px 0;
        }
        
        .pattern-cell {
            width: 60px;
            height: 60px;
            background: #333;
            border: 1px solid #00ff00;
            cursor: pointer;
        }
        
        .pattern-cell.active {
            background: #00ff00;
        }
        
        .code-input {
            background: #0a0a0a;
            border: 1px solid #00ff00;
            color: #00ff00;
            padding: 10px;
            font-size: 18px;
            text-align: center;
            margin: 10px 0;
            width: 200px;
        }
        
        .btn {
            background: #00ff00;
            color: #0a0a0a;
            border: none;
            padding: 10px 20px;
            margin: 10px;
            cursor: pointer;
            font-weight: bold;
        }
        
        .final-message {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.9);
            padding: 40px;
            border-radius: 15px;
            text-align: center;
            max-width: 500px;
            z-index: 1000;
        }
        
        .glitch-text {
            font-size: 24px;
            color: #00ff00;
            animation: glitch 1s infinite;
        }
        
        @keyframes glitch {
            0% { transform: translate(0); }
            20% { transform: translate(-2px, 2px); }
            40% { transform: translate(-2px, -2px); }
            60% { transform: translate(2px, 2px); }
            80% { transform: translate(2px, -2px); }
            100% { transform: translate(0); }
        }
    </style>
</head>
<body>
    <div class="scene">
        <div class="box" id="mainBox">
            <div class="face front">
                <h2>MYSTERY BOX</h2>
                <p>Click to examine</p>
                <p style="font-size: 12px; margin-top: 20px;">There are secrets hidden within...</p>
            </div>
            <div class="face back locked">
                <h2>ðŸ”’ PATTERN LOCK</h2>
                <p>Draw the secret pattern</p>
            </div>
            <div class="face right locked">
                <h2>ðŸ”’ CODE REQUIRED</h2>
                <p>Enter the 4-digit code</p>
            </div>
            <div class="face left locked">
                <h2>ðŸ”’ MEMORY TEST</h2>
                <p>Remember the sequence</p>
            </div>
            <div class="face top locked">
                <h2>ðŸ”’ FINAL CHALLENGE</h2>
                <p>Answer the question</p>
            </div>
            <div class="face bottom">
                <h2>INSTRUCTIONS</h2>
                <p>Solve all puzzles to reveal the surprise</p>
            </div>
        </div>
    </div>

    <!-- Pattern Lock Interface -->
    <div class="puzzle-interface" id="patternLock">
        <h3>Draw the Secret Pattern</h3>
        <div class="pattern-grid" id="patternGrid">
            <!-- Grid cells will be generated by JavaScript -->
        </div>
        <button class="btn" onclick="checkPattern()">Submit Pattern</button>
        <button class="btn" onclick="closePuzzle()">Close</button>
    </div>

    <!-- Code Input Interface -->
    <div class="puzzle-interface" id="codeInput">
        <h3>Enter the 4-Digit Code</h3>
        <input type="text" class="code-input" id="codeField" maxlength="4" placeholder="____">
        <div>
            <button class="btn" onclick="checkCode()">Submit Code</button>
            <button class="btn" onclick="closePuzzle()">Close</button>
        </div>
    </div>

    <!-- Memory Game Interface -->
    <div class="puzzle-interface" id="memoryGame">
        <h3>Remember the Sequence</h3>
        <div id="sequenceDisplay"></div>
        <div class="pattern-grid" id="memoryGrid"></div>
        <button class="btn" onclick="startMemoryGame()">Start</button>
        <button class="btn" onclick="closePuzzle()">Close</button>
    </div>

    <!-- Question Interface -->
    <div class="puzzle-interface" id="questionPuzzle">
        <h3>Final Question</h3>
        <p id="questionText">Where did we first meet?</p>
        <input type="text" class="code-input" id="answerField" placeholder="Your answer">
        <div>
            <button class="btn" onclick="checkAnswer()">Submit Answer</button>
            <button class="btn" onclick="closePuzzle()">Close</button>
        </div>
    </div>

    <!-- Final Surprise -->
    <div class="final-message" id="finalMessage">
        <h2 class="glitch-text">CONGRATULATIONS!</h2>
        <p>You've unlocked the mystery!</p>
        <div id="personalMessage">
            <!-- Personalized message will appear here -->
        </div>
        <button class="btn" onclick="location.reload()">Play Again</button>
    </div>

    <script>
        // Box rotation and interaction
        const box = document.getElementById('mainBox');
        let currentRotation = 0;
        
        box.addEventListener('click', (e) => {
            const rect = box.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            
            // Determine which face was clicked based on position
            if (x < 100) {
                openPuzzle('left');
            } else if (x > 200) {
                openPuzzle('right');
            } else if (y < 100) {
                openPuzzle('top');
            } else if (y > 200) {
                // Bottom face - just rotate
                rotateBox();
            } else {
                // Center - check if back face is accessible
                if (!document.querySelector('.back').classList.contains('locked')) {
                    openPuzzle('back');
                } else {
                    rotateBox();
                }
            }
        });
        
        function rotateBox() {
            currentRotation += 90;
            box.style.transform = `rotateY(${currentRotation}deg)`;
        }
        
        // Puzzle management
        function openPuzzle(face) {
            const puzzleId = face + 'Puzzle';
            document.getElementById(puzzleId).style.display = 'block';
            
            // Initialize specific puzzles
            if (face === 'back') initPatternLock();
            if (face === 'right') initCodeInput();
            if (face === 'left') initMemoryGame();
        }
        
        function closePuzzle() {
            document.querySelectorAll('.puzzle-interface').forEach(el => {
                el.style.display = 'none';
            });
        }
        
        // Pattern Lock Puzzle
        function initPatternLock() {
            const grid = document.getElementById('patternGrid');
            grid.innerHTML = '';
            
            for (let i = 0; i < 9; i++) {
                const cell = document.createElement('div');
                cell.className = 'pattern-cell';
                cell.dataset.index = i;
                cell.addEventListener('click', togglePatternCell);
                grid.appendChild(cell);
            }
            
            // Reset pattern
            window.currentPattern = [];
        }
        
        function togglePatternCell(e) {
            const index = parseInt(e.target.dataset.index);
            if (window.currentPattern.includes(index)) {
                window.currentPattern = window.currentPattern.filter(i => i !== index);
                e.target.classList.remove('active');
            } else {
                window.currentPattern.push(index);
                e.target.classList.add('active');
            }
        }
        
        function checkPattern() {
            // The correct pattern is a simple shape (like an L or cross)
            const correctPattern = [0, 1, 2, 5, 8]; // Example: top row + right column
            
            if (JSON.stringify(window.currentPattern) === JSON.stringify(correctPattern)) {
                document.querySelector('.back').classList.remove('locked');
                alert('Pattern correct! This side is now unlocked.');
                closePuzzle();
            } else {
                alert('Incorrect pattern. Try again!');
                initPatternLock();
            }
        }
        
        // Code Input Puzzle
        function initCodeInput() {
            document.getElementById('codeField').value = '';
        }
        
        function checkCode() {
            const code = document.getElementById('codeField').value;
            // The code could be a significant date (like 1215 for Dec 15)
            if (code === '1215') {
                document.querySelector('.right').classList.remove('locked');
                alert('Code accepted! This side is now unlocked.');
                closePuzzle();
            } else {
                alert('Incorrect code. Try again!');
            }
        }
        
        // Memory Game Puzzle
        function initMemoryGame() {
            document.getElementById('sequenceDisplay').textContent = 'Press Start to begin';
            const grid = document.getElementById('memoryGrid');
            grid.innerHTML = '';
            
            for (let i = 0; i < 9; i++) {
                const cell = document.createElement('div');
                cell.className = 'pattern-cell';
                cell.dataset.index = i;
                cell.addEventListener('click', checkMemorySequence);
                grid.appendChild(cell);
            }
            
            window.memorySequence = [];
            window.userMemoryInput = [];
        }
        
        function startMemoryGame() {
            // Generate a random sequence of 5 lights
            window.memorySequence = [];
            for (let i = 0; i < 5; i++) {
                window.memorySequence.push(Math.floor(Math.random() * 9));
            }
            
            // Display the sequence
            const display = document.getElementById('sequenceDisplay');
            display.textContent = 'Watch carefully...';
            
            let i = 0;
            const interval = setInterval(() => {
                if (i >= window.memorySequence.length) {
                    clearInterval(interval);
                    display.textContent = 'Now repeat the sequence!';
                    return;
                }
                
                const index = window.memorySequence[i];
                const cells = document.querySelectorAll('#memoryGrid .pattern-cell');
                cells[index].classList.add('active');
                
                setTimeout(() => {
                    cells[index].classList.remove('active');
                }, 500);
                
                i++;
            }, 1000);
            
            window.userMemoryInput = [];
        }
        
        function checkMemorySequence(e) {
            if (window.memorySequence.length === 0) return;
            
            const index = parseInt(e.target.dataset.index);
            window.userMemoryInput.push(index);
            
            // Check if sequence is correct so far
            for (let i = 0; i < window.userMemoryInput.length; i++) {
                if (window.userMemoryInput[i] !== window.memorySequence[i]) {
                    alert('Wrong sequence! Try again.');
                    initMemoryGame();
                    return;
                }
            }
            
            // Check if complete sequence is correct
            if (window.userMemoryInput.length === window.memorySequence.length) {
                document.querySelector('.left').classList.remove('locked');
                alert('Perfect memory! This side is now unlocked.');
                closePuzzle();
            }
        }
        
        // Question Puzzle
        function checkAnswer() {
            const answer = document.getElementById('answerField').value.toLowerCase();
            // Personalize this with your own meaningful question/answer
            if (answer.includes('coffee') || answer.includes('cafe')) {
                document.querySelector('.top').classList.remove('locked');
                showFinalSurprise();
                closePuzzle();
            } else {
                alert('Incorrect answer. Try again!');
            }
        }
        
        // Final Surprise
        function showFinalSurprise() {
            document.getElementById('finalMessage').style.display = 'block';
            
            // Personalize this message
            const personalMessage = document.getElementById('personalMessage');
            personalMessage.innerHTML = `
                <p style="margin: 20px 0; font-size: 18px;">
                    You've solved all the puzzles! This shows how well you know me and how persistent you are. 
                    I appreciate you so much and wanted to create something special to show it.
                </p>
                <p style="margin: 10px 0;">
                    How about we go to that coffee shop where we first met this weekend? My treat! â˜•
                </p>
            `;
        }
        
        // Initialize the box
        rotateBox();
    </script>
</body>
</html>
